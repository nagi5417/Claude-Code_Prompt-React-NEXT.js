<!-- 🔵 汎用: どのプロジェクトでも使える -->

# 共通コーディング規約

## TypeScript

- strict モード必須。any 型は絶対に使用しない
- 未使用変数は `_` プレフィックス
- enum よりも const object + `as const` を推奨
- 型アサーション（as）は最終手段。型ガードを優先

## インポート

- 順序: react → next → 外部ライブラリ → @/ 内部パス → ./ 相対パス
- バレルエクスポート（index.ts）を活用

## Git

- Conventional Commits: feat: / fix: / refactor: / test: / docs: / chore:
- 1コミット1論理変更
- main ブランチへの直接プッシュ禁止

## ドキュメント

- 公開関数には JSDoc コメント
- 複雑なロジックにはインラインコメント
- コードが自明な箇所にはコメント不要（自己文書化を優先）

## Gate: 実装前の確認事項

以下が不明確な場合、コーディングを開始せず質問すること：

- API の入出力形式が未定義
- エラーハンドリングとステータスコードが未指定
- 認証・認可の要件が不明確
- データ整合性ルール（ユニーク制約、削除ポリシー）が不明確

## 完了の定義（最低条件）

### 共通

- 動作を証明できるまでタスクを完了としない（自己申告完了は禁止）
- テスト実行・型チェック（`npx tsc --noEmit`）・リント通過を必ず確認
- 「スタッフエンジニアがこれを承認するか？」と自問してから完了とする
- 必要に応じて main ブランチとの差分を確認する

### UI の変更には以下を含むこと：

- loading / empty / error 各状態の処理
- 型チェック通過（`npx tsc --noEmit`）
- 目視またはスクリーンショットでの動作確認

### API の変更には以下を含むこと：

- 入力のバリデーション
- 統一エラー形式とステータスコード
- 最低2つの異常系ケースの考慮（理想的にはテスト付き）
- 実際にリクエストを投げての動作確認

## コード品質チェック

- 重要な変更の前に「もっとシンプルな方法はないか？」と一度立ち止まること
- ハック的な修正になりそうなら、今知っている情報をすべて踏まえてエレガントな解決策を実装する
- ただしシンプルで明白な修正にはこのプロセスをスキップする（過剰設計しない）
- 提示する前に自分の作業を自問自答すること

## エラー発生時の対応方針

- 型エラー（tsc）: 自力で修正を試みる（最大3回まで）
- テスト失敗: テストコード側の修正は OK。実装コードの変更が必要な場合はユーザーに確認
- lint エラー: `eslint --fix` で自動修正。手動修正が必要な場合は対応する
- ビルドエラー: エラー内容を報告し、修正方針を提案してからユーザーに確認
- 3回試しても解決しない場合: エラーログを貼り付けてユーザーに報告する
